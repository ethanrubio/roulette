angular.module("pubroulette",["ngMap","ngMaterial","pubroulette.uberapi","pubroulette.yelpapi","pubroulette.map","pubroulette.mapMaker","pubroulette.loader","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("homepage",{url:"/",controller:"AppController"}),b.otherwise("/")}]).controller("AppController",["$scope","UberAPI","YelpAPI","Map","$mdDialog",function(a,b,c,d,e){a.success=function(){c.clickedFirst(),a.showAlert(),console.log("here I am!"),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e,f){a.$apply(function(){a.position=e,console.log("lat: "+a.position.coords.latitude+" long:"+a.position.coords.longitude),c.passLocation(a.position.coords.latitude,a.position.coords.longitude).then(function(c){a.name=c.data.name,a.destination=c.data.location.coordinate,b.passLocation(a.position.coords.latitude,a.position.coords.longitude,c.data.location.coordinate.latitude,c.data.location.coordinate.longitude).then(function(b){console.log("this is the resp from the controller from uber",b),d.mapStore(a.position.coords.latitude,a.position.coords.longitude,a.destination.latitude,a.destination.longitude,a.name)})})}),f&&console.log(f)})},a.showAlert=function(a){e.show(e.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("We're spinning the roulette wheel.").textContent("Hold on!").ariaLabel("It's spinning.").ok("Got it!").targetEvent(a))}}]),angular.module("pubroulette.map",[]).factory("Map",["$window",function(a){var b,c={startLat:"",startLong:"",endLat:"",endLong:"",name:""},d=function(){return b},e=function(a,d,e,f,g){b=!0,c.startLat=a,c.startLong=d,c.endLat=e,c.endLong=f,c.name=g};return{coordinates:c,mapStore:e,mapShow:d}}]),angular.module("pubroulette.uberapi",[]).factory("UberAPI",["$http",function(a){var b={},c=function(c,d,e,f){return a({method:"POST",url:"/api/uber/journey",data:{startLat:c,startLong:d,endLat:e,endLong:f}}).then(function(a){return console.log("uber API got a response! ",a),b.data=a.data,console.log("Hi this is the uberData in UberAPI being set",b),a})};return{passLocation:c,uberData:b}}]),angular.module("pubroulette.yelpapi",[]).factory("YelpAPI",["$http",function(a){var b,c=function(){return b},d=function(){b=!0},e=function(b,c){return a({method:"POST",url:"/api/yelp/location",data:{lat:b,"long":c}}).then(function(a){return console.log("Yelp API got a response! ",a),a})};return{passLocation:e,clicked:c,clickedFirst:d}}]),angular.module("pubroulette.mapMaker",[]).controller("MapController",["$scope","$log","$timeout","Map","UberAPI","$mdDialog",function(a,b,c,d,e,f){a.mapShow=function(){var a=!1;return d.mapShow()===!0&&(a=!0),a},a.coordinates={},a.uberData={},a.$watch(function(){return d.coordinates},function(b,c){b!==c&&(console.log("this is inside mapcontroller",b),a.coordinates=b)},!0),a.$watch(function(){return e.uberData},function(b,c){console.log("Hi I'm watching the uberData ",e.uberData),b!==c&&(console.log("this is inside mapcontroller for Uber ",b),a.uberData=b,a.showConfirm())},!0),a.showConfirm=function(b){var c=f.confirm().title("You're about to go to "+a.coordinates.name+".").textContent("It'll cost about "+a.uberData.data.prices[0].estimate+".").ariaLabel("Uber Confirmation").targetEvent(b).ok("Teleport me there!").cancel("Spin again.");f.show(c).then(function(){a.status="You decided to go to collect your winnings!",a.showAlert()},function(){a.status="You decided spin again."})},a.showAlert=function(a){f.show(f.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Your uber is being hailed.").textContent("Have fun!").ariaLabel("Your uber is on it's way").ok("Thanks!").targetEvent(a))}}]).directive("ngMapBuilder",function(){return{restrict:"E",template:'<div style="width:70%  height: 100%"> <ng-map zoom="14" center="{{ coordinates.startLat + \',\' + coordinates.startLong }}" style="height:90%" > <directions travel-mode="DRIVING" origin=" {{ coordinates.startLat + \',\' + coordinates.startLong }}" destination="{{ coordinates.endLat + \',\' + coordinates.endLong }}"> </directions> </ng-map> </div>'}}),angular.module("pubroulette.loader",[]).controller("LoaderController",["$scope","Map","YelpAPI",function(a,b,c){a.mapShow=function(){var a=!1;return b.mapShow()===!0&&(a=!0),a},a.clicked=function(){var a=!1;return c.clicked()===!0&&(a=!0),a}}]).directive("ngLoading",function(){return{restrict:"E",template:"<md-progress-linear ng-if='mapShow() === false && clicked() === true' md-mode='indeterminate'></md-progress-linear>"}});